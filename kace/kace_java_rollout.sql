SELECT MACHINE.NAME AS SYSTEM_NAME,
       SYSTEM_DESCRIPTION,
       MACHINE.IP,
       MACHINE.MAC,
       MACHINE.ID as TOPIC_ID
FROM MACHINE
WHERE SUBSTRING(MACHINE.NAME, 5, 1) IN (
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 0 THEN '0' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 1 THEN '1' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 2 THEN '2' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 3 THEN '3' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 4 THEN '4' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 5 THEN '5' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 6 THEN '6' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 7 THEN '7' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 8 THEN '8' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 9 THEN '9' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 10 THEN 'A' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 11 THEN 'B' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 12 THEN 'C' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 13 THEN 'D' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 14 THEN 'E' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 15 THEN 'F' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 16 THEN 'G' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 17 THEN 'H' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 18 THEN 'I' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 19 THEN 'J' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 20 THEN 'K' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 21 THEN 'L' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 22 THEN 'M' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 23 THEN 'N' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 24 THEN 'O' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 25 THEN 'P' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 26 THEN 'Q' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 27 THEN 'R' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 28 THEN 'S' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 29 THEN 'T' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 30 THEN 'U' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 31 THEN 'V' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 32 THEN 'W' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 33 THEN 'X' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 34 THEN 'Y' ELSE NULL END,
    CASE WHEN DATEDIFF(CURDATE(), '2024-06-01') / 7 >= 35 THEN 'Z' ELSE NULL END
)
AND (
    EXISTS (
        SELECT 1
        FROM CATALOG.SAM_CATALOG
        JOIN SAM_MACHINE_JT ON CATALOG.SAM_CATALOG.ID = SAM_MACHINE_JT.SAM_CATALOG_ID
        WHERE MACHINE.ID = SAM_MACHINE_JT.MACHINE_ID
          AND CATALOG.SAM_CATALOG.NAME LIKE 'Java Runtime 8%'
    )
)
AND (
    EXISTS (
        SELECT 1
        FROM SOFTWARE
        JOIN MACHINE_SOFTWARE_JT ON SOFTWARE.ID = MACHINE_SOFTWARE_JT.SOFTWARE_ID
        WHERE MACHINE_SOFTWARE_JT.MACHINE_ID = MACHINE.ID
          AND SOFTWARE.DISPLAY_VERSION LIKE '8%'
    )
)